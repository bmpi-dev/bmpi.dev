<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="author" content="马大伟">
  
  <meta name="description" content="本文讲述了基于词法分析和语法分析等编译原理知识使用bison开发一款解析ToDo格式文本的解析Parser">
  
  
  <meta name="keywords" content="时间管理、工具、parser解析器、jison、bison、lex、flex、bnf、yacc、dsl、词法分析、语法分析、编译原理">
  

  
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:site" content="@BMPI11">
  <meta name="twitter:creator" content="@madawei2699">
  <meta name="twitter:title" content="Parser黑魔法"/>
  <meta name="twitter:description" content="本文讲述了基于词法分析和语法分析等编译原理知识使用bison开发一款解析ToDo格式文本的解析Parser"/>
  
  <meta name="twitter:image" content="https://www.bmpi.dev/images/mdw.png">
  

  
  <meta property="og:title" content="Parser黑魔法" />
<meta property="og:description" content="本文讲述了基于词法分析和语法分析等编译原理知识使用bison开发一款解析ToDo格式文本的解析Parser" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.bmpi.dev/dev/parser_black_magic/" /><meta property="article:section" content="dev" />
<meta property="article:published_time" content="2019-12-21T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-01-22T21:01:13&#43;08:00" /><meta property="og:site_name" content="构建我的被动收入" />


  
  <meta name="og:image" content="https://www.bmpi.dev/images/mdw.png">
  

  

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      
      "@type": "BlogPosting",
      
      "headline": "Parser黑魔法",
      "image": "https://www.bmpi.dev/images/mdw2.png",
      "datePublished": "2019-12-21T00:00:00Z",
      "dateModified": "2021-01-22T21:01:13+08:00",
      "author": {
        "@type": "Person",
        "name": "马大伟"
      },
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://www.bmpi.dev/dev/parser_black_magic/"
      },
      "publisher": {
        "@type": "Organization",
        "name": "BMPI.dev",
        "logo": {
          "@type": "ImageObject",
          "url": "https://www.bmpi.dev/images/mdw2.png"
        }
      },
      "description": "本文讲述了基于词法分析和语法分析等编译原理知识使用bison开发一款解析ToDo格式文本的解析Parser",
      "keywords": ["时间管理", "工具", "parser解析器", "jison", "bison", "lex", "flex", "bnf", "yacc", "dsl", "词法分析", "语法分析", "编译原理"]
    }
    </script>



  
  <base href="https://www.bmpi.dev/dev/parser_black_magic/">
  
  <title>
  Parser黑魔法 · 构建我的被动收入
</title>

  
  <link rel="canonical" href="https://www.bmpi.dev/dev/parser_black_magic/">
  

  <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

  
  
  
  <link rel="stylesheet" href="https://www.bmpi.dev/css/coder.min.deacf4638e988eb7ad13026417a95fe49dbb6368f04ffe5ffa15de11c942ed6c.css" integrity="sha256-3qz0Y46YjretEwJkF6lf5J27Y2jwT/5f&#43;hXeEclC7Ww="
    crossorigin="anonymous" media="screen" />
  

  

  
  
  
  
  <link rel="stylesheet" href="https://www.bmpi.dev/css/coder-dark.min.83a2010dac9f59f943b3004cd6c4f230507ad036da635d3621401d42ec4e2835.css" integrity="sha256-g6IBDayfWflDswBM1sTyMFB60DbaY102IUAdQuxOKDU="
    crossorigin="anonymous" media="screen" />
  
  

  
  <link rel="stylesheet" href="https://www.bmpi.dev/css/main.css" />
  

  
  <script src="https://www.bmpi.dev/js/lazysizes.min.js" async></script>
  
  <script src="https://www.bmpi.dev/js/flying-pages.min.js" async></script>
  
  <script src="https://www.bmpi.dev/js/custom.js" async></script>
  

  <link rel="icon" type="image/png" href="https://www.bmpi.dev/images/f3/favicon-32x32.png"
    sizes="32x32">
  <link rel="icon" type="image/png" href="https://www.bmpi.dev/images/f3/favicon-16x16.png"
    sizes="16x16">

  <link rel="amphtml" type="text/html" href="https://www.bmpi.dev/amp/dev/parser_black_magic/" title="构建我的被动收入" />
  <meta name="generator" content="Hugo 0.83.1" />

  <meta name="baidu-site-verification" content="TiReu51WyJ" />

  
  
  <link rel="stylesheet" href="https://www.bmpi.dev/scss/tagcloud.css" media="screen" />

  
  <script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=600a642fe0b9b900111a7f08&product=inline-share-buttons' async='async'></script>
  

  
</head>






<body class="colorscheme-auto">
  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://www.bmpi.dev/">
      构建我的被动收入
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://datastudio.google.com/reporting/6c3c6d3d-cd2f-4f8c-85e6-c06d672c445b">Dashboard</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.bmpi.dev/about/">关于</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.bmpi.dev/self/">学习</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.bmpi.dev/dev/">技术</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.bmpi.dev/money/">投资</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.bmpi.dev/project/">个人项目</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.bmpi.dev/goal/">长期目标</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://tg.bmpi.dev">思考</a>
          </li>
        
      
      
        
        
        
          
        
          
            
              <li class="navigation-item menu-separator">
                <span>|</span>
              </li>
              
            
            <li class="navigation-item">
              <a href="https://www.bmpi.dev/en/">English</a>
            </li>
          
        
      
    </ul>
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Parser黑魔法</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2019-12-21T00:00:00Z'>
                2019-12-21
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              
              
              
              18:21
              
            </span>
            
            <span class="post-word-count"> | 4037 字 | </span>
            <span id="post-views"></span> 次阅读
            
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://www.bmpi.dev/tags/%E6%97%B6%E9%97%B4%E7%AE%A1%E7%90%86/">时间管理</a>
      <span class="separator">•</span>
    <a href="https://www.bmpi.dev/tags/%E5%B7%A5%E5%85%B7/">工具</a>
      <span class="separator">•</span>
    <a href="https://www.bmpi.dev/tags/parser%E8%A7%A3%E6%9E%90%E5%99%A8/">parser解析器</a>
      <span class="separator">•</span>
    <a href="https://www.bmpi.dev/tags/jison/">jison</a>
      <span class="separator">•</span>
    <a href="https://www.bmpi.dev/tags/bison/">bison</a>
      <span class="separator">•</span>
    <a href="https://www.bmpi.dev/tags/lex/">lex</a>
      <span class="separator">•</span>
    <a href="https://www.bmpi.dev/tags/flex/">flex</a>
      <span class="separator">•</span>
    <a href="https://www.bmpi.dev/tags/bnf/">bnf</a>
      <span class="separator">•</span>
    <a href="https://www.bmpi.dev/tags/yacc/">yacc</a>
      <span class="separator">•</span>
    <a href="https://www.bmpi.dev/tags/dsl/">dsl</a>
      <span class="separator">•</span>
    <a href="https://www.bmpi.dev/tags/%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/">词法分析</a>
      <span class="separator">•</span>
    <a href="https://www.bmpi.dev/tags/%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90/">语法分析</a>
      <span class="separator">•</span>
    <a href="https://www.bmpi.dev/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理</a></div>

        </div>
      </header>

      <div class="article">
        
        
        
        
        <p>我们在开发过程中对于文本处理一般会用Regex来搞定，比如识别一个字符串中的邮箱及手机号之类。但是对于复杂的文本格式，我们可能会通过写一个解析工具来解析，但是你可能很难想到用flex/bison来做。想象下这么一个场景，你需要将Nginx的conf文件转换成json格式。</p>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-1886683614725279"
     data-ad-slot="5360039010"></ins>
<script type='text/javascript'>
(function() {
var done = false;
var script = document.createElement('script');
script.async = true;
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js';

var createScript = setTimeout(
function(){
document.getElementsByTagName('HEAD').item(0).appendChild(script);
}, 5000
);

script.onreadystatechange = script.onload = function(e) {
if (!done && (!this.readyState || this.readyState == 'loaded' || this.readyState == 'complete')) {
(adsbygoogle = window.adsbygoogle || []).push({});
}
};
})();
</script>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nginx" data-lang="nginx"><span style="color:#fff;font-weight:bold">worker_processes</span>  <span style="color:#ff0;font-weight:bold">1</span>;
<span style="color:#fff;font-weight:bold">events</span> {
    <span style="color:#fff;font-weight:bold">worker_connections</span>  <span style="color:#ff0;font-weight:bold">1024</span>;
}
<span style="color:#fff;font-weight:bold">http</span> {
    <span style="color:#fff;font-weight:bold">include</span>       <span style="color:#0ff;font-weight:bold">mime.types</span>;
    <span style="color:#fff;font-weight:bold">default_type</span>  <span style="color:#0ff;font-weight:bold">application/octet-stream</span>;
    <span style="color:#fff;font-weight:bold">sendfile</span>        on;
    <span style="color:#fff;font-weight:bold">keepalive_timeout</span>  <span style="color:#ff0;font-weight:bold">65</span>;
    <span style="color:#fff;font-weight:bold">server</span> {
        <span style="color:#fff;font-weight:bold">listen</span>       <span style="color:#ff0;font-weight:bold">80</span>;
        <span style="color:#fff;font-weight:bold">server_name</span>  <span style="color:#0ff;font-weight:bold">localhost</span>;
        <span style="color:#fff;font-weight:bold">location</span> <span style="color:#0ff;font-weight:bold">/</span> {
            <span style="color:#fff;font-weight:bold">root</span>   <span style="color:#0ff;font-weight:bold">html</span>;
            <span style="color:#fff;font-weight:bold">index</span>  <span style="color:#0ff;font-weight:bold">index.html</span> <span style="color:#0ff;font-weight:bold">index.htm</span>;
        }
    }
}
</code></pre></div><p>这个格式解析单靠Regex是搞不定的。我们需要更强的Text Processing Tools<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>。我们知道一门计算机语言和一个Nginx配置文件本质上是由特定词法和语法组成的，了解编译器识别计算机语言的过程有助于我们进一步解决Nginx配置文件的解析。</p>
<h2 id="compiler-architecture">Compiler Architecture</h2>
<figure >
    <a href="https://cs.lmu.edu/~ray/notes/compilerarchitecture/">
        <img data-src="https://img.bmpi.dev/2019-12-21-19-15-21.png" class="lazyload" loading="lazy" alt="Compiler Architecture" />
    </a>
    
    <figcaption>
        <p>
        Compiler Architecture
        
            
        
        </p> 
    </figcaption>
    
</figure>
<p>如上图所示，在我们的问题域中最关心的是Lexical Analysis与Syntax Analysis。</p>
<h3 id="lexical-analysis">Lexical Analysis</h3>
<p>Lexical Analysis将以下的C语言函数：</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#fff;font-weight:bold">void</span> do_awesome_stuff(<span style="color:#fff;font-weight:bold">int</span> a, string b) {
    <span style="color:#007f7f">/* Code here */</span>
}
</code></pre></div><p>Token化为：</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">TYPE: void
IDENTIFIER: do_awesome_stuff
OPEN_BRACKET: (
TYPE: int
IDENTIFIER: a,
COMMA: ,
TYPE: string
IDENTIFIER: b
CLOSE_BRACKET: )
OPEN_BRACE: {
COMMENT: /* Code here */*
CLOSE_BRACE: }
</code></pre></div><h3 id="syntax-analysis">Syntax Analysis</h3>
<p>Syntax Analysis将Token序列解析为Abstract Syntax Tree<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>:</p>
<p><img data-src="https://img.bmpi.dev/2019-12-21-19-29-39.png" alt="" class="lazyload" loading="lazy"/></p>
<p>有了AST（抽象语法树）后，可以进一步生成IR（中间语言），也可以在语义分析中做语法正确性检查（如各种语法lint工具）。</p>
<figure >
    <a href="https://starbeamrainbowlabs.com/blog/article.php?article=posts%2F267-Compilers-101.html">
        <img data-src="https://img.bmpi.dev/2019-12-21-19-35-40.png" class="lazyload" loading="lazy" alt="BNF/Flex/Bison" />
    </a>
    
    <figcaption>
        <p>
        BNF/Flex/Bison
        
            
        
        </p> 
    </figcaption>
    
</figure>
<p>如上图所示，第1、2、3步中出现了BNF、Flex、Bison。</p>
<h3 id="bnfbackus-normal-form">BNF(Backus normal form)</h3>
<blockquote>
<p>Backus–Naur form or Backus normal form (BNF) is a notation technique for context-free grammars, often used to describe the syntax of languages used in computing, such as computer programming languages, document formats, instruction sets and communication protocols. They are applied wherever exact descriptions of languages are needed: for instance, in official language specifications, in manuals, and in textbooks on programming language theory.<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></p>
</blockquote>
<p>简单来说，BNF是一种用于表示上下文无关(CFG)文法的形式语言(形式语言一般有两个方面：语法和语义，由字母表上的某些有限长字符串的集合)。</p>
<h3 id="cfgcontext-free-grammars">CFG(context-free grammars)</h3>
<p>在计算机科学中，若一个形式文法 G = (V, Σ, P, S) 的产生式规则都取如下的形式：A -&gt; α，则谓之。其中 A∈V ，α∈(V∪Σ)* 。上下文无关文法取名为“上下文无关”的原因就是因为字符 A 总可以被字符串 α 自由替换，而无需考虑字符 A 出现的上下文。一个形式语言是上下文无关的，如果它是由上下文无关文法生成的。上下文无关文法重要的原因在于它们拥有足够强的表达力来表示大多数程序设计语言的语法；实际上，几乎所有程序设计语言都是通过上下文无关文法来定义的。BNF（巴克斯-诺尔范式）经常用来表达上下文无关文法。<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup></p>
<h3 id="flex">Flex</h3>
<p>Flex在Lexical Analysis阶段用来生成词法分析器。</p>
<h3 id="bison">Bison</h3>
<p>Bison用于自动生成语法分析器(Parser)程序，实际上可用于所有常见的操作系统。Bison把LALR形式的上下文无关文法描述转换为可做语法分析的C或C++程序。</p>
<h3 id="lalrlllr">LALR/LL/LR</h3>
<p>在计算机科学中，LALR分析器是一种规范LR分析方法的简化形式。它可以对上下无关文法进行语法分析。LALR即“Look-Ahead LR”。其中，Look-Ahead为“向前看”，L代表对输入进行从左到右的检查，R代表反向构造出最右推导序列。 LALR分析器可以根据一种程序设计语言的正式语法的产生式而对一段文本程序输入进行语法分析，从而在语法层面上判断输入程序是否合法。 实际应用中的LALR分析器并不是由人手工写成的，而是由类似于yacc和GNU Bison之类的LALR语法分析器生成工具构成。<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup></p>
<p>LL分析器是一种处理某些上下文无关文法的自顶向下分析器。因为它从左（Left）到右处理输入，再对句型执行最左推导出语法树（Left derivation，相对于LR分析器）。能以此方法分析的文法称为LL文法。<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup></p>
<h3 id="automata-theory">Automata Theory</h3>
<p>我们知道，自动化理论（automata theory）里，有FSA（Finite State Automata）和PDA（PushDown Automata），前者可以用regular expression表述，而后者可以处理CFG（Context Free Grammar）。而CFG便是flex/bison要处理的对象！<sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup></p>
<figure >
    
        <img data-src="https://img.bmpi.dev/2019-12-21-22-56-22.png" class="lazyload" loading="lazy" alt="Automata Theory" />
    
    
    <figcaption>
        <p>
        Automata Theory
        
            
        
        </p> 
    </figcaption>
    
</figure>
<p>能被DFA和NFA识别的语言是正则语言。能被PDA识别的语言为CFG语言。几乎所有程序设计语言都是通过CFG来定义的。BNF经常用来表达CFG。</p>
<p><strong>所以我们知道靠正则是解决不了Nginx配置文件这种CFG语言的。这种情况需要我们写BNF文法来解决。</strong></p>
<h3 id="compiler-compiler">Compiler-compiler</h3>
<p>一个编译器编译程序(compiler-compiler)或者编译器产生程序(compiler generator)是一个帮助用户根据某种语言或机器的规则来产生语法分析器，解释器或者编译器的工具。当前最早也是最常见的编译器编译程序是语法分析器产生程序(parser generator)这个形式，其输入是一个编程语言的形式文法 (一般是用BNF表示)，然后产生出一些语法分析器的代码，作为这个语言编译器的一部分。</p>
<p>理想的编译器编译程序，只要给予一个编程语言的完整描述以及目标的指令集架构，然后就能自动从中产生出合适的编译器。实际上, 最先进的技术还没有到达这么复杂的地步，而大多数现有的编译器产生程序都不能处理语义学或者目标架构的信息部分。<sup id="fnref:8"><a href="#fn:8" class="footnote-ref" role="doc-noteref">8</a></sup></p>
<h2 id="不同语言的parser生成器">不同语言的Parser生成器</h2>
<table>
<thead>
<tr>
<th>语言</th>
<th>Parser</th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td>bison</td>
</tr>
<tr>
<td>clojure</td>
<td>instaparse</td>
</tr>
<tr>
<td>javascript</td>
<td>jison</td>
</tr>
<tr>
<td>javascript</td>
<td>peg.js</td>
</tr>
<tr>
<td>各种语言</td>
<td>antlr4</td>
</tr>
<tr>
<td>golang</td>
<td>participle</td>
</tr>
<tr>
<td>erlang</td>
<td>yecc</td>
</tr>
</tbody>
</table>
<p>其他的详见 <a href="https://en.wikipedia.org/wiki/Comparison_of_parser_generators">Comparison_of_parser_generators</a> 。</p>
<h2 id="使用js写一个parser">使用JS写一个Parser</h2>
<p>了解完上面这么多枯燥的理论，是时候该实战了，让我们使用Parser解决一个真正的问题。在<a href="https://www.bmpi.dev/zh-cn/self/gtd-tools-i-used/">《我的时间管理工具》</a>这篇文章中提到我开发了<a href="https://github.com/bmpi-dev/todo_parser_lib">todo_parser_lib</a>，这个库便是用JavaScript的jison库开发的解析todo文件为json的AST格式的功能。</p>
<p>jison到底有多强，可以从这里感受下: <a href="https://github.com/zaach/jison/wiki/ProjectsUsingJison">ProjectsUsingJison</a>。</p>
<p>todo文件是一种类似yaml/python缩进风格的纯文本格式的文件，如下：</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">test1:
    ☐ test list1 @started(19-12-11 21:16)
    &gt; test list1 comm
    ✔ test list2 @critical @started(19-12-11 21:16) @done(19-12-11 21:17) @lasted(1m2s)
    ✘ cancel @cancelled(19-12-11 21:28)
    test2:
        ☐ test list21 @started(19-12-11 21:16)
        ✔ test list22 @critical @started(19-12-11 21:16) @done(19-12-11 21:17) @lasted(1m2s)
        ✘ test list23 cancel @cancelled(19-12-11 21:28)

test3:
    ☐ test list31 @started(19-12-11 21:16)
    ✔ test list32 @critical @started(19-12-16 09:24) @done(19-12-16 09:24) @lasted(41s)
</code></pre></div><p>我们最终要生成如下的JSON Scheme:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">[
  {
    <span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;test1:&#34;</span>,
    <span style="font-weight:bold">&#34;todo&#34;</span>: [
      {
        <span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;☐ test list1 @started(19-12-11 21:16)&#34;</span>,
        <span style="font-weight:bold">&#34;todo&#34;</span>: []
      },
      {
        <span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;test2:&#34;</span>,
        <span style="font-weight:bold">&#34;todo&#34;</span>: [
          {
            <span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;☐ test list21 @started(19-12-11 21:16)&#34;</span>,
            <span style="font-weight:bold">&#34;todo&#34;</span>: []
          }
        ]
      }
    ]
  },
  {
    <span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;test3:&#34;</span>,
    <span style="font-weight:bold">&#34;todo&#34;</span>: [
      {
        <span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;☐ test list31 @started(19-12-11 21:16)&#34;</span>,
        <span style="font-weight:bold">&#34;todo&#34;</span>: []
      }
    ]
  }
]
</code></pre></div><h3 id="step1词法分析">step1/词法分析</h3>
<p>Javascript的jison自带了词法分析功能，不过也可以使用第三方的词法分析库，由于yaml/python缩进风格的文法，本身不是CFG，需要我们做一定的处理才能正常的Token化<sup id="fnref:9"><a href="#fn:9" class="footnote-ref" role="doc-noteref">9</a></sup>。在这里我们使用<a href="https://github.com/aaditmshah/lexer">lexer</a>来解析缩进风格的文法。</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#fff;font-weight:bold">const</span> Lexer = require(<span style="color:#0ff;font-weight:bold">&#39;lex&#39;</span>);
<span style="color:#fff;font-weight:bold">const</span> row = <span style="color:#ff0;font-weight:bold">1</span>;
<span style="color:#fff;font-weight:bold">let</span> col = <span style="color:#ff0;font-weight:bold">1</span>;
<span style="color:#fff;font-weight:bold">const</span> indent = [<span style="color:#ff0;font-weight:bold">0</span>];
<span style="color:#fff;font-weight:bold">const</span> lexer = module.exports = <span style="color:#fff;font-weight:bold">new</span> Lexer(<span style="color:#fff;font-weight:bold">function</span>(<span style="color:#fff;font-weight:bold">char</span>) {
  <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> <span style="color:#fff;font-weight:bold">Error</span>(<span style="color:#0ff;font-weight:bold">&#39;Unexpected character at row &#39;</span> + row + <span style="color:#0ff;font-weight:bold">&#39;, col &#39;</span> + col + <span style="color:#0ff;font-weight:bold">&#39;: &#39;</span> + <span style="color:#fff;font-weight:bold">char</span>);
});
global.flag = <span style="color:#ff0;font-weight:bold">0</span>; <span style="color:#007f7f">// 0 - doing, 1 - critical
</span><span style="color:#007f7f"></span>module.exports.changeFlag = <span style="color:#fff;font-weight:bold">function</span> changeFlag(flag) {
  global.flag = flag;
};
lexer.addRule(<span style="color:#0ff;font-weight:bold">/^[\t ]*/gm</span>, <span style="color:#fff;font-weight:bold">function</span>(lexeme) {
  <span style="color:#fff;font-weight:bold">const</span> indentation = lexeme.length;
  col += indentation;
  <span style="color:#fff;font-weight:bold">if</span> (indentation &gt; indent[<span style="color:#ff0;font-weight:bold">0</span>]) {
    indent.unshift(indentation);
    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#39;INDENT&#39;</span>;
  }
  <span style="color:#fff;font-weight:bold">const</span> tokens = [];
  <span style="color:#fff;font-weight:bold">while</span> (indentation &lt; indent[<span style="color:#ff0;font-weight:bold">0</span>]) {
    tokens.push(<span style="color:#0ff;font-weight:bold">&#39;DEDENT&#39;</span>);
    indent.shift();
  }
  <span style="color:#fff;font-weight:bold">if</span> (tokens.length) <span style="color:#fff;font-weight:bold">return</span> tokens;
});
lexer.addRule(<span style="color:#0ff;font-weight:bold">/\n+/gm</span>, <span style="color:#fff;font-weight:bold">function</span>(lexeme) {
  <span style="color:#007f7f">// col = 1;
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// row += lexeme.length;
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// return &#34;NEWLINE&#34;;
</span><span style="color:#007f7f"></span>});
lexer.addRule(<span style="color:#0ff;font-weight:bold">/.*/gm</span>, <span style="color:#fff;font-weight:bold">function</span>(lexeme) {
  col += lexeme.length;
  <span style="color:#fff;font-weight:bold">const</span> projectRe = <span style="color:#0ff;font-weight:bold">/^.*:$/g</span>;
  <span style="color:#fff;font-weight:bold">if</span> (lexeme.length == <span style="color:#ff0;font-weight:bold">0</span>) {
    <span style="color:#007f7f">// return &#34;EMPTY&#34;
</span><span style="color:#007f7f"></span>  } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (lexeme.trim().startsWith(<span style="color:#0ff;font-weight:bold">&#39;&gt; &#39;</span>)) {
    <span style="color:#007f7f">// return &#34;COMMENT&#34;
</span><span style="color:#007f7f"></span>  } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (lexeme.trim().includes(<span style="color:#0ff;font-weight:bold">&#39;@done&#39;</span>) || lexeme.trim().includes(<span style="color:#0ff;font-weight:bold">&#39;@cancelled&#39;</span>)) {
    <span style="color:#007f7f">// return &#34;DONE&#34;
</span><span style="color:#007f7f"></span>  } <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (projectRe.test(lexeme.trim())) {
    <span style="color:#fff;font-weight:bold">this</span>.yytext = lexeme;
    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#39;NAME&#39;</span>;
  } <span style="color:#fff;font-weight:bold">else</span> {
    <span style="color:#007f7f">// doing todo item
</span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (global.flag == <span style="color:#ff0;font-weight:bold">0</span> &amp;&amp; lexeme.trim().includes(<span style="color:#0ff;font-weight:bold">&#39;@started&#39;</span>)) {
      <span style="color:#fff;font-weight:bold">this</span>.yytext = lexeme;
      <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#39;NAME&#39;</span>;
    }
    <span style="color:#007f7f">// critical item but is not doing
</span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (global.flag == <span style="color:#ff0;font-weight:bold">1</span> &amp;&amp; lexeme.trim().includes(<span style="color:#0ff;font-weight:bold">&#39;@critical&#39;</span>) &amp;&amp; !lexeme.trim().includes(<span style="color:#0ff;font-weight:bold">&#39;started&#39;</span>)) {
      <span style="color:#fff;font-weight:bold">this</span>.yytext = lexeme;
      <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#39;NAME&#39;</span>;
    }
  }
});
lexer.addRule(<span style="color:#0ff;font-weight:bold">/$/gm</span>, <span style="color:#fff;font-weight:bold">function</span>() {
  col++;
  <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#39;EOF&#39;</span>;
});
</code></pre></div><p>Token化的核心是使用特殊的Token替代被Token化文件中的符合正则表达式的字符串，我们这里只关注缩进INDENT/DEDENT和Todo待办事项的NAME，还有文件结束符EOF，所以你可以猜到最终被lexer输出的是个Token List:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">NAME: test1:
INDENT
NAME: ☐ test list1 @started(19-12-11 21:16)
NAME: ✘ cancel @cancelled(19-12-11 21:28)
NAME: test2:
INDENT
NAME: ☐ test list21 @started(19-12-11 21:16)
NAME: ✘ test list23 cancel @cancelled(19-12-11 21:28)
DEDENT
DEDENT
NAME: test3:
INDENT
NAME: ☐ test list31 @started(19-12-11 21:16)
DEDENT
EOF
</code></pre></div><h3 id="step2语法分析">step2/语法分析</h3>
<p>有了上述Token List做输入给jison做BNF语法分析，最终解析出json AST。先看BNF语法：</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">{
  &#39;bnf&#39;: {
    &#39;todo-plus&#39;: [
      [&#39;todo-list EOF&#39;, &#39;return $1;&#39;],
      [&#39;EOF&#39;, &#39;return null&#39;],
    ],
    &#39;todo-list&#39;: [
      [&#39;todo&#39;, &#39;$$ = $1 == null ? null : [$1];&#39;],
      [&#39;todo-list todo&#39;,
        &#39;if ($1 == null) { $$ = $2; } &#39; +
        &#39;else { if ($2 == null) { $$ == $1; } &#39; +
        &#39;else { $$ = [].concat($1).concat($2); } };&#39;],
    ],
    &#39;todo&#39;: [
      [&#39;item&#39;, &#39;$$ = {name: $1, todo: []};&#39;],
      [&#39;item INDENT todo-list DEDENT&#39;, &#39;$$ = $3 == null ? $3 : {name: $1, todo: $3};&#39;],
      [&#39;item INDENT DEDENT&#39;, &#39;$$ = null;&#39;],
      [&#39;INDENT DEDENT&#39;, &#39;$$ = null&#39;],
    ],
    &#39;item&#39;: [
      [&#39;NAME&#39;, &#39;$$ = yytext;&#39;],
    ],
  },
}
</code></pre></div><p>BNF就是递归的分解要解析的文件字符串，直到遇到不可分割的Token，比如文件一开始肯定会拆解为 &lsquo;todo-list EOF&rsquo; ，然后 todo-list 可以进一步分割直到 NAME 和 INDENT/DEDENT ，jison是兼容bison语法的，所以如果一脸懵比可以先看下<a href="http://dinosaur.compilertools.net/bison/bison_6.html#SEC34">bison语法帮助文档</a>。</p>
<h3 id="step3render">step3/Render</h3>
<p>经过语法分析，我们得到了json字符串，在这里我们可以使用<a href="https://github.com/janl/mustache.js">mustache.js</a>将json渲染为HTML，我们只需要定义好Template，然后调用mustache render即可。</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#fff;font-weight:bold">const</span> Mustache = require(<span style="color:#0ff;font-weight:bold">&#39;mustache&#39;</span>);
<span style="color:#fff;font-weight:bold">const</span> fs = require(<span style="color:#0ff;font-weight:bold">&#39;fs&#39;</span>);

module.exports = <span style="color:#fff;font-weight:bold">function</span> render(doingJson, criticalJson) {
  <span style="color:#fff;font-weight:bold">const</span> todoTemplate = fs.readFileSync(<span style="color:#ff0;font-weight:bold">__</span>dirname + <span style="color:#0ff;font-weight:bold">&#39;/template/todo_template.mustache&#39;</span>);
  <span style="color:#fff;font-weight:bold">const</span> outputDoingHtml = Mustache.render(todoTemplate.toString(), doingJson, {
    recurse: todoTemplate.toString(),
  });
  <span style="color:#fff;font-weight:bold">const</span> outputCriticalHtml = Mustache.render(todoTemplate.toString(), criticalJson, {
    recurse: todoTemplate.toString(),
  });
  <span style="color:#fff;font-weight:bold">const</span> indexTemplate = fs.readFileSync(<span style="color:#ff0;font-weight:bold">__</span>dirname + <span style="color:#0ff;font-weight:bold">&#39;/template/index_template.mustache&#39;</span>);
  <span style="color:#fff;font-weight:bold">const</span> outputIndexHtml = Mustache.to_html(indexTemplate.toString(), {doing: {}, critical: {}}, {
    doing: outputDoingHtml,
    critical: outputCriticalHtml,
  });
  <span style="color:#fff;font-weight:bold">return</span> outputIndexHtml;
};
</code></pre></div><div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">&lt;ul class=&#39;todos&#39; style=&#39;margin: 10px 0;&#39;&gt;
{{#todo}}
&lt;li class=&#39;todo&#39; style=&#39;list-style-type: none;&#39;&gt; {{ name }} &lt;/li&gt;
{{&gt; recurse }}
{{/todo}}
&lt;/ul&gt;
</code></pre></div><p>需要在这里注意的时，由于我们的JSON Scheme是嵌套的todo list，所以模版的渲染也需要嵌套<sup id="fnref:10"><a href="#fn:10" class="footnote-ref" role="doc-noteref">10</a></sup>。</p>
<h3 id="step4工程化">step4/工程化</h3>
<p>核心代码完成后，我们需要重构，应用一些工程实践，比如单元测试<sup id="fnref:11"><a href="#fn:11" class="footnote-ref" role="doc-noteref">11</a></sup>、命令行工具<sup id="fnref:12"><a href="#fn:12" class="footnote-ref" role="doc-noteref">12</a></sup>、CI自动发布工具到NPM仓库<sup id="fnref:13"><a href="#fn:13" class="footnote-ref" role="doc-noteref">13</a></sup>。</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">.
├── README.md
├── bin
│   └── todo-cli.js
├── lib
│   ├── ast.js
│   ├── lexer.js
│   ├── parser.js
│   ├── render.js
│   └── template
│       ├── index_template.mustache
│       └── todo_template.mustache
├── package-lock.json
├── package.json
└── <span style="color:#fff;font-weight:bold">test</span>
    ├── test_data
    │   ├── critical.json
    │   ├── doing.json
    │   ├── test.doing.json
    │   ├── test.lex
    │   ├── test.todo
    │   ├── test1.critical.json
    │   ├── test1.lex
    │   └── test1.todo
    └── test_parser.js
</code></pre></div><p>这块不在赘述，感兴趣的可以参考<a href="https://github.com/bmpi-dev/todo_parser_lib">源代码</a>。</p>
<h2 id="nginx配置文件parser">Nginx配置文件Parser</h2>
<p>让我们回到开始的问题，现在你可以使用BNF去大胆的写一个解析Nginx配置文件的Parser吧。</p>
<h2 id="进一步阅读">进一步阅读</h2>
<p>创作一门属于自己的Toy Language/Compiler，可以看看这篇文章 <a href="https://gnuu.org/2009/09/18/writing-your-own-toy-compiler/">Writing Your Own Toy Compiler Using Flex, Bison and LLVM</a> 。</p>
<p>当然也可以看看王垠的 <a href="http://www.yinwang.org/blog-cn/2015/09/19/parser">《对 Parser 的误解》</a> 。</p>
<p>想看大型编程语言的语法分析，可以看看Elixir基于Erlang平台是怎么把自己编译成Erlang的：<a href="https://github.com/elixir-lang/elixir/blob/master/lib/elixir/src/elixir_parser.yrl">elixir_parser.yrl</a></p>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-1886683614725279"
     data-ad-slot="5360039010"></ins>
<script type='text/javascript'>
(function() {
var done = false;
var script = document.createElement('script');
script.async = true;
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js';

var createScript = setTimeout(
function(){
document.getElementsByTagName('HEAD').item(0).appendChild(script);
}, 5000
);

script.onreadystatechange = script.onload = function(e) {
if (!done && (!this.readyState || this.readyState == 'loaded' || this.readyState == 'complete')) {
(adsbygoogle = window.adsbygoogle || []).push({});
}
};
})();
</script>
<h4 id="references"><em>References</em></h4>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://www.shlomifish.org/open-source/resources/text-processing-tools/">List of Text Processing Tools</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p><a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">https://en.wikipedia.org/wiki/Abstract_syntax_tree</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p><a href="https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_form">https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_form</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p><a href="https://zh.wikipedia.org/wiki/%E4%B8%8A%E4%B8%8B%E6%96%87%E6%97%A0%E5%85%B3%E6%96%87%E6%B3%95">https://zh.wikipedia.org/wiki/%E4%B8%8A%E4%B8%8B%E6%96%87%E6%97%A0%E5%85%B3%E6%96%87%E6%B3%95</a>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5" role="doc-endnote">
<p><a href="https://zh.wikipedia.org/wiki/LALR%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E5%99%A8">https://zh.wikipedia.org/wiki/LALR%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E5%99%A8</a>&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6" role="doc-endnote">
<p><a href="https://zh.wikipedia.org/wiki/LL%E5%89%96%E6%9E%90%E5%99%A8">https://zh.wikipedia.org/wiki/LL%E5%89%96%E6%9E%90%E5%99%A8</a>&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7" role="doc-endnote">
<p><a href="https://zhuanlan.zhihu.com/p/20178871">如何愉快地写个小parser</a>&#160;<a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:8" role="doc-endnote">
<p><a href="https://zh.wikipedia.org/wiki/%E7%B7%A8%E8%AD%AF%E5%99%A8%E7%B7%A8%E8%AD%AF%E7%A8%8B%E5%BC%8F">https://zh.wikipedia.org/wiki/%E7%B7%A8%E8%AD%AF%E5%99%A8%E7%B7%A8%E8%AD%AF%E7%A8%8B%E5%BC%8F</a>&#160;<a href="#fnref:8" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:9" role="doc-endnote">
<p><a href="https://stackoverflow.com/questions/14803043/looking-for-examples-of-jison-grammars-that-use-indentation-for-block-structure">Looking for examples of Jison grammars that use indentation for block-structure</a>&#160;<a href="#fnref:9" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:10" role="doc-endnote">
<p><a href="https://github.com/janl/mustache.js/issues/468">https://github.com/janl/mustache.js/issues/468</a>&#160;<a href="#fnref:10" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:11" role="doc-endnote">
<p><a href="https://www.ibm.com/developerworks/cn/opensource/os-tutorials-learn-nodejs-unit-testing-in-nodejs/index.html">学习 Node.js，第 9 单元：单元测试</a>&#160;<a href="#fnref:11" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:12" role="doc-endnote">
<p><a href="https://www.kancloud.cn/kancloud/command-line-with-node/48657">Node.js 命令行程序开发教程</a>&#160;<a href="#fnref:12" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:13" role="doc-endnote">
<p><a href="https://github.com/bmpi-dev/todo_parser_lib/blob/master/.github/workflows/npm-publish.yml">npm-publish.yml</a>&#160;<a href="#fnref:13" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>


        
        <div style="color: #5c7080;font-size: small;font-style: italic;">
          更新时间:
          
          
          
          
          
              4个月前
          
           版本: <a href="https://github.com/madawei2699/bmpi.dev/commit/5750fdef29285eb60bd558bc0522244f1fb90224">5750fde</a>
        </div>
        

        <div style="text-align: center;color: darkgray;">
          
          <p>本作品采用<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" style="color: darkgray;">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可</p>
          
        </div>

        <div style="border-bottom-style: dashed;border-bottom-style: inset;border-bottom-width: 2px;width: 50%;margin: 0 auto;"></div>
      </div>

      <footer>
        <div>
  
  <h2 style="border-style: none;margin: 10px 0;">相关文章推荐</h2>
  
  <div style="padding-left: 10px;">
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li style="list-style: none;"><a href="https://www.bmpi.dev/dev/vscode-plugin-development-notes/">VSCode插件开发小记</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li style="list-style: none;"><a href="https://www.bmpi.dev/self/gtd-tools-i-used/">我的时间管理工具</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
  </div>
  <div style="border-bottom-style: dashed;border-bottom-style: inset;border-bottom-width: 2px;width: 50%;margin: 20px auto;"></div>
</div>

        <div class="sharethis-inline-reaction-buttons"></div>
<div class="sharethis-inline-share-buttons"></div>

        <div style="color: darkgreen;">
  <form style="border:1px dashed #ccc;padding:10px 10px;margin: 10px auto;text-align:center;width: 95%;" action="https://tinyletter.com/i365" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/i365', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    
    <span>每月一份邮件，分享我对如何构建被动收入的思考、推荐文章及资源，欢迎订阅</span>
    
    <p style="margin: 10px 0;"><input type="text" style="width:240px;text-align: center;" name="email" id="tlemail" placeholder="Email"/></p>
    <input type="hidden" value="1" name="embed"/>
    
    <input type="submit" value="订阅" />
    
  </form>
</div>

        


        
        
        <script src="https://utteranc.es/client.js"
  repo= "bmpi-dev/bmpi.dev"
  issue-term="title"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <div class="footer-taxonomy">
    <div style="margin-bottom: 10px;">
      <a href="https://wiki.bmpi.dev/">Wiki</a>
      ⚔️
      <a href="https://talk.bmpi.dev/">Talk</a>
      ⚔️
      <a href="https://www.bmpi.dev/invest/">Invest</a>
    </div>
    <div>
      <a href= /affiliate >Affiliate</a>
      ⚡️
      <a href= /tool >Tool</a>
      ⚡️
      <a href= /link >Link</a>
    </div>
  </div>
  <div class="footer-taxonomy">
    <a href= /tags style="color: #B36D61;">Tags</a>
    👈
    <a href= /categories style="color: #FF8C31;">Categories</a>
    👉
    <a href= /series style="color: #519A73;">Series</a>
  </div>
  <section class="container">
    
     © 2019 - 2021
    
    
  </section>
</footer>

  </main>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154678195-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-154678195-1');
  </script>
  

  
  <script>(function(w,d, s, id) {w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.src = "https://cdn.webpushr.com/app.min.js";fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));webpushr('init','BHuwaXciWicBjh6HQS2tfudv6IYQD11K9u1NUj7nuaEV9NoDT7ns9JjgqyYTflUv-m3TlD7ELY84AHMfgmPXNgU');</script>
  

</body>

</html>
