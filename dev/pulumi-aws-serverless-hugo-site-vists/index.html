<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="author" content="é©¬å¤§ä¼Ÿ">
  
  <meta name="description" content="æœ¬æ–‡ä»‹ç»äº†åŸºäºServerlessæ¶æ„çš„ä½¿ç”¨Pulumiä¸AWSå®ç°Hugoé™æ€åšå®¢çš„è®¿é—®ç»Ÿè®¡åŠŸèƒ½ã€‚">
  
  
  <meta name="keywords" content="AWSã€Lambdaã€Serverlessã€Pulumiã€, Vercelã€Infrastructure, as, codeã€æ— æœåŠ¡å™¨æ¶æ„ã€Hugoã€ç‹¬ç«‹åšå®¢ã€ä¸ªäººåšå®¢ã€æŠ€æœ¯åšå®¢">
  

  
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:site" content="@BMPI11">
  <meta name="twitter:creator" content="@madawei2699">
  <meta name="twitter:title" content="åŸºäºServerlesså®ç°é™æ€åšå®¢è®¿é—®ç»Ÿè®¡åŠŸèƒ½"/>
  <meta name="twitter:description" content="æœ¬æ–‡ä»‹ç»äº†åŸºäºServerlessæ¶æ„çš„ä½¿ç”¨Pulumiä¸AWSå®ç°Hugoé™æ€åšå®¢çš„è®¿é—®ç»Ÿè®¡åŠŸèƒ½ã€‚"/>
  
  <meta name="twitter:image" content="https://www.bmpi.dev/images/mdw.png">
  

  
  <meta property="og:title" content="åŸºäºServerlesså®ç°é™æ€åšå®¢è®¿é—®ç»Ÿè®¡åŠŸèƒ½" />
<meta property="og:description" content="æœ¬æ–‡ä»‹ç»äº†åŸºäºServerlessæ¶æ„çš„ä½¿ç”¨Pulumiä¸AWSå®ç°Hugoé™æ€åšå®¢çš„è®¿é—®ç»Ÿè®¡åŠŸèƒ½ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.bmpi.dev/dev/pulumi-aws-serverless-hugo-site-vists/" /><meta property="article:section" content="dev" />
<meta property="article:published_time" content="2021-01-24T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-01-24T19:50:36&#43;08:00" /><meta property="og:site_name" content="æ„å»ºæˆ‘çš„è¢«åŠ¨æ”¶å…¥" />



  
  <meta name="og:image" content="https://www.bmpi.dev/images/mdw.png">
  

  

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      
      "@type": "BlogPosting",
      
      "headline": "åŸºäºServerlesså®ç°é™æ€åšå®¢è®¿é—®ç»Ÿè®¡åŠŸèƒ½",
      "image": "https://www.bmpi.dev/images/mdw2.png",
      "datePublished": "2021-01-24T00:00:00Z",
      "dateModified": "2021-01-24T19:50:36+08:00",
      "author": {
        "@type": "Person",
        "name": "é©¬å¤§ä¼Ÿ"
      },
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://www.bmpi.dev/dev/pulumi-aws-serverless-hugo-site-vists/"
      },
      "publisher": {
        "@type": "Organization",
        "name": "BMPI.dev",
        "logo": {
          "@type": "ImageObject",
          "url": "https://www.bmpi.dev/images/mdw2.png"
        }
      },
      "description": "æœ¬æ–‡ä»‹ç»äº†åŸºäºServerlessæ¶æ„çš„ä½¿ç”¨Pulumiä¸AWSå®ç°Hugoé™æ€åšå®¢çš„è®¿é—®ç»Ÿè®¡åŠŸèƒ½ã€‚",
      "keywords": ["AWS", "Lambda", "Serverless", "Pulumi", "Vercel", "Infrastructure as code", "æ— æœåŠ¡å™¨æ¶æ„", "Hugo", "ç‹¬ç«‹åšå®¢", "ä¸ªäººåšå®¢", "æŠ€æœ¯åšå®¢"]
    }
    </script>



  
  <base href="https://www.bmpi.dev/dev/pulumi-aws-serverless-hugo-site-vists/">
  
  <title>
  åŸºäºServerlesså®ç°é™æ€åšå®¢è®¿é—®ç»Ÿè®¡åŠŸèƒ½ Â· æ„å»ºæˆ‘çš„è¢«åŠ¨æ”¶å…¥
</title>

  
  <link rel="canonical" href="https://www.bmpi.dev/dev/pulumi-aws-serverless-hugo-site-vists/">
  

  <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

  
  
  
  <link rel="stylesheet" href="https://www.bmpi.dev/css/coder.min.deacf4638e988eb7ad13026417a95fe49dbb6368f04ffe5ffa15de11c942ed6c.css" integrity="sha256-3qz0Y46YjretEwJkF6lf5J27Y2jwT/5f&#43;hXeEclC7Ww="
    crossorigin="anonymous" media="screen" />
  

  

  
  
  
  
  <link rel="stylesheet" href="https://www.bmpi.dev/css/coder-dark.min.83a2010dac9f59f943b3004cd6c4f230507ad036da635d3621401d42ec4e2835.css" integrity="sha256-g6IBDayfWflDswBM1sTyMFB60DbaY102IUAdQuxOKDU="
    crossorigin="anonymous" media="screen" />
  
  

  
  <link rel="stylesheet" href="https://www.bmpi.dev/css/main.css" />
  

  
  <script src="https://www.bmpi.dev/js/lazysizes.min.js" async></script>
  
  <script src="https://www.bmpi.dev/js/flying-pages.min.js" async></script>
  
  <script src="https://www.bmpi.dev/js/custom.js" async></script>
  

  <link rel="icon" type="image/png" href="https://www.bmpi.dev/images/f3/favicon-32x32.png"
    sizes="32x32">
  <link rel="icon" type="image/png" href="https://www.bmpi.dev/images/f3/favicon-16x16.png"
    sizes="16x16">

  <link rel="amphtml" type="text/html" href="https://www.bmpi.dev/amp/dev/pulumi-aws-serverless-hugo-site-vists/" title="æ„å»ºæˆ‘çš„è¢«åŠ¨æ”¶å…¥" />
  <meta name="generator" content="Hugo 0.83.1" />

  <meta name="baidu-site-verification" content="TiReu51WyJ" />

  
  
  <link rel="stylesheet" href="https://www.bmpi.dev/scss/tagcloud.css" media="screen" />

  
  <script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=600a642fe0b9b900111a7f08&product=inline-share-buttons' async='async'></script>
  

  
</head>






<body class="colorscheme-auto">
  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://www.bmpi.dev/">
      æ„å»ºæˆ‘çš„è¢«åŠ¨æ”¶å…¥
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://datastudio.google.com/reporting/6c3c6d3d-cd2f-4f8c-85e6-c06d672c445b">Dashboard</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.bmpi.dev/about/">å…³äº</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.bmpi.dev/self/">å­¦ä¹ </a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.bmpi.dev/dev/">æŠ€æœ¯</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.bmpi.dev/money/">æŠ•èµ„</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.bmpi.dev/project/">ä¸ªäººé¡¹ç›®</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.bmpi.dev/goal/">é•¿æœŸç›®æ ‡</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://tg.bmpi.dev">æ€è€ƒ</a>
          </li>
        
      
      
        
        
        
          
        
          
            
              <li class="navigation-item menu-separator">
                <span>|</span>
              </li>
              
            
            <li class="navigation-item">
              <a href="https://www.bmpi.dev/en/">English</a>
            </li>
          
        
      
    </ul>
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">åŸºäºServerlesså®ç°é™æ€åšå®¢è®¿é—®ç»Ÿè®¡åŠŸèƒ½</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2021-01-24T00:00:00Z'>
                2021-01-24
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              
              
              
              6:18
              
            </span>
            
            <span class="post-word-count"> | 1386 å­— | </span>
            <span id="post-views"></span> æ¬¡é˜…è¯»
            
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://www.bmpi.dev/tags/aws/">AWS</a>
      <span class="separator">â€¢</span>
    <a href="https://www.bmpi.dev/tags/lambda/">Lambda</a>
      <span class="separator">â€¢</span>
    <a href="https://www.bmpi.dev/tags/serverless/">Serverless</a>
      <span class="separator">â€¢</span>
    <a href="https://www.bmpi.dev/tags/pulumi/">Pulumi</a>
      <span class="separator">â€¢</span>
    <a href="https://www.bmpi.dev/tags/vercel/">Vercel</a>
      <span class="separator">â€¢</span>
    <a href="https://www.bmpi.dev/tags/infrastructure-as-code/">Infrastructure as code</a>
      <span class="separator">â€¢</span>
    <a href="https://www.bmpi.dev/tags/%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9E%B6%E6%9E%84/">æ— æœåŠ¡å™¨æ¶æ„</a>
      <span class="separator">â€¢</span>
    <a href="https://www.bmpi.dev/tags/hugo/">Hugo</a>
      <span class="separator">â€¢</span>
    <a href="https://www.bmpi.dev/tags/%E7%8B%AC%E7%AB%8B%E5%8D%9A%E5%AE%A2/">ç‹¬ç«‹åšå®¢</a>
      <span class="separator">â€¢</span>
    <a href="https://www.bmpi.dev/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/">ä¸ªäººåšå®¢</a>
      <span class="separator">â€¢</span>
    <a href="https://www.bmpi.dev/tags/%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2/">æŠ€æœ¯åšå®¢</a></div>

        </div>
      </header>

      <div class="article">
        
        
        
        
        <h2 id="èƒŒæ™¯">èƒŒæ™¯</h2>
<p>æˆ‘åœ¨ <a href="https://www.bmpi.dev/series/%E9%9B%B6%E6%88%90%E6%9C%AC%E6%90%AD%E5%BB%BA%E7%8E%B0%E4%BB%A3%E5%8D%9A%E5%AE%A2%E6%8C%87%E5%8D%97/">é›¶æˆæœ¬æ­å»ºç°ä»£åšå®¢æŒ‡å—</a> ç³»åˆ—æ–‡ç« é‡Œè¯¦ç»†ä»‹ç»äº†æœ¬åšå®¢çš„æ­å»ºè¿‡ç¨‹ï¼Œæœ¬ç«™æ˜¯åŸºäº Hugo æ¡†æ¶ç”Ÿæˆçš„ï¼Œå¹¶éƒ¨ç½²åœ¨ Vercel å¹³å°ä¸Šã€‚</p>
<p>å’Œæœ€æµè¡Œçš„ CMS æ¡†æ¶ Wordpress ä¸åŒï¼ŒHugo/Hexo/Gatsby ç­‰é™æ€ç«™ç‚¹ç”Ÿæˆçš„æŠ€æœ¯å¥½å¤„åœ¨äºï¼š</p>
<ul>
<li>æˆæœ¬æä½ç”šè‡³å…è´¹ï¼Œæ— éœ€ä¸“é—¨çš„ VPS æœåŠ¡å™¨ï¼Œåªéœ€è¦å°†ç”Ÿæˆå¥½çš„é™æ€é¡µé¢æ‰˜ç®¡åˆ° CDN/GitHub Pages/Vercel/Netlify/AWS S3 è¿™ç±»å¹³å°ä¸Šå³å¯ï¼›</li>
<li>Wordpress å¹¶å‘æ€§èƒ½å·®ï¼Œè€Œé™æ€åšå®¢åªå—é™äºä¸æµé‡å¸¦å®½çš„é™åˆ¶ï¼Œä¸å­˜åœ¨æ€§èƒ½å’Œå¹¶å‘é—®é¢˜ã€‚</li>
</ul>
<p>ä½†å’Œ Wordpress ç›¸æ¯”ï¼Œå› ä¸ºå…¨ç«™éƒ½æ˜¯é™æ€åŒ–ç”Ÿæˆçš„é¡µé¢ï¼Œæ²¡æœ‰åå°æœåŠ¡å™¨çš„æ¥å£æ”¯æŒï¼Œæ— æ³•å®ç°ä¸€äº›å¾ˆç®€å•çš„å¸¦çŠ¶æ€çš„åŠŸèƒ½ï¼Œå¦‚ä¸æ”¯æŒé¡µé¢é˜…è¯»æ•°é‡ç»Ÿè®¡åŠŸèƒ½ã€‚</p>
<p>è¿™ç§ <a href="https://jamstack.org/">Jamstack</a> æ¶æ„çš„ç«™ç‚¹è¦å®ç°åŠ¨æ€çš„åŠŸèƒ½ï¼Œä¸€èˆ¬ä¼šé‡‡ç”¨ Serverless çš„æ–¹å¼å»å®ç°ã€‚</p>
<p><img data-src="https://img.bmpi.dev/84527ff9-9fa8-ecbf-63e9-bbfd77712c4a.png" alt="" class="lazyload" loading="lazy"/></p>
<h2 id="ä¸ºä½•è¦å®ç°åšå®¢çš„è®¿é—®ç»Ÿè®¡åŠŸèƒ½">ä¸ºä½•è¦å®ç°åšå®¢çš„è®¿é—®ç»Ÿè®¡åŠŸèƒ½</h2>
<p>æœ¬åšå®¢æ—©å·²æ¥å…¥äº† Google Analytics ï¼Œä½†æ˜¯ä¸ºä½•è¿˜è¦å®ç°åšå®¢çš„è®¿é—®ç»Ÿè®¡åŠŸèƒ½ï¼Ÿä¸€æ–¹é¢è€ƒè™‘åˆ°æ–‡ç« çš„é˜…è¯»æ•°é‡å¯ä»¥ä¾›è¯»è€…æ›´å®¹æ˜“è¯†åˆ«æ­¤ç¯‡æ–‡ç« æ˜¯å¦æ˜¯çƒ­é—¨æ–‡ç« ï¼Œå¦ä¸€æ–¹é¢è¿™ç§é˜…è¯»é‡æ•°æ®å¯¹ç™¾åº¦ SEO æœ‰æ­£å‘æå‡ä½œç”¨ã€‚Google Analytics çš„é—®é¢˜åœ¨äºä¸€æ—¦ç”¨æˆ·å®‰è£…äº†æŸäº›å±è”½å¹¿å‘Šæ’ä»¶åï¼ŒåŒæ—¶ä¹Ÿä¼šå¯¼è‡´ GA æ— æ³•æ­£å¸¸å·¥ä½œï¼Œæ ¹æ®æŸäº›æ–‡ç« ç»Ÿè®¡è¯´ä¸€èˆ¬ä¼šæŸå¤±è¿‘ 10% çš„æµé‡ç»Ÿè®¡ã€‚</p>
<h2 id="å®ç°è®¿é—®ç»Ÿè®¡åŠŸèƒ½çš„æŠ€æœ¯é€‰æ‹©">å®ç°è®¿é—®ç»Ÿè®¡åŠŸèƒ½çš„æŠ€æœ¯é€‰æ‹©</h2>
<p>åœ¨é€‰æ‹©å®ç°æ­¤åŠŸèƒ½çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æœ‰å¦‚ä¸‹é€‰æ‹©ï¼š</p>
<ul>
<li>ä½¿ç”¨ Vercel/Netlify æä¾›çš„ <a href="https://vercel.com/docs/serverless-functions/introduction">Serverless Functions</a>ï¼Œè¿™ç§æ–¹å¼å¯ä»¥å‚è€ƒè¿™ç¯‡ <a href="https://www.joshwcomeau.com/react/serverless-hit-counter/">Building a Modern-Day Hit Counter</a> ï¼›</li>
<li>ä½¿ç”¨ Next.js æ¡†æ¶ï¼Œè¿™ç§æ–¹å¼å¯ä»¥å‚è€ƒè¿™ç¯‡ <a href="https://leerob.io/blog/real-time-post-views">Real-Time Blog Post Views With Next.js and Firebase</a> ï¼›</li>
<li>ä½¿ç”¨åŸºäº AWS çš„ Serverless æ¶æ„å®ç°ã€‚</li>
</ul>
<p>å› ä¸ºä¹‹å‰ä½¿ç”¨è¿‡ Terraform å®ç°åŸºäº AWS å¹³å°çš„ Serverless æ¶æ„ï¼Œå…·ä½“è¿‡ç¨‹å¯ä»¥å‚åŠ è¿™ç¯‡ <a href="https://www.bmpi.dev/dev/guide-to-serverless/">Serverlessåº”ç”¨å¼€å‘å°è®°</a> ï¼Œæ‰€ä»¥æˆ‘æœ€ç»ˆé€‰æ‹©äº†ç¬¬ä¸‰ç§æ–¹å¼å»åšã€‚</p>
<p>è¿™æ¬¡æˆ‘ä½¿ç”¨ Pulumi å®ç° Serverless æ¶æ„ã€‚Pulumi ç›¸æ¯” Terraform çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥ä»¥ç¼–ç¨‹æ–¹å¼å®ç° Infrastructure as code ï¼Œç›¸ä¿¡çœ‹å®Œè¯¥ç¯‡æ–‡ç« ä½ å°±èƒ½çŸ¥é“å®ƒçš„å¼ºå¤§äº†ã€‚</p>
<h2 id="ä½¿ç”¨-pulumi-å®ç°åšå®¢è®¿é—®ç»Ÿè®¡æ¥å£">ä½¿ç”¨ Pulumi å®ç°åšå®¢è®¿é—®ç»Ÿè®¡æ¥å£</h2>
<p>å…ˆåˆ›å»ºä¸€ä¸ª <a href="https://www.pulumi.com/">Pulumi</a> å·¥ç¨‹ï¼š</p>
<p><img data-src="https://img.bmpi.dev/a923b2bd-13bf-4e24-402d-dc6104b92048.png" alt="" class="lazyload" loading="lazy"/></p>
<p>æˆ‘ä»¬é€‰ AWS + TypeScript ã€‚</p>
<p>ä¹‹åæŒ‰æç¤ºåˆ›å»ºç›®å½•åŠå®‰è£…ä¾èµ–ï¼Œå·¥ç¨‹ç›®å½•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">.
â”œâ”€â”€ Pulumi.dev.yaml
â”œâ”€â”€ Pulumi.yaml
â”œâ”€â”€ README.md
â”œâ”€â”€ index.ts
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
</code></pre></div><p>åªéœ€è¦ç¼–è¾‘ index.ts å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#fff;font-weight:bold">import</span> * <span style="color:#fff;font-weight:bold">as</span> aws <span style="color:#fff;font-weight:bold">from</span> <span style="color:#0ff;font-weight:bold">&#34;@pulumi/aws&#34;</span>;
<span style="color:#fff;font-weight:bold">import</span> * <span style="color:#fff;font-weight:bold">as</span> awsx <span style="color:#fff;font-weight:bold">from</span> <span style="color:#0ff;font-weight:bold">&#34;@pulumi/awsx&#34;</span>;
<span style="color:#fff;font-weight:bold">import</span> * <span style="color:#fff;font-weight:bold">as</span> pulumi <span style="color:#fff;font-weight:bold">from</span> <span style="color:#0ff;font-weight:bold">&#34;@pulumi/pulumi&#34;</span>;

<span style="color:#007f7f">// Create a mapping from &#39;route&#39; to a count
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">const</span> counterTable = <span style="color:#fff;font-weight:bold">new</span> aws.dynamodb.Table(<span style="color:#0ff;font-weight:bold">&#34;api-bmpi-dev&#34;</span>, {
    attributes: [{
        name: <span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>,
        <span style="color:#fff;font-weight:bold">type</span>: <span style="color:#0ff;font-weight:bold">&#34;S&#34;</span>,
    }],
    hashKey: <span style="color:#0ff;font-weight:bold">&#34;id&#34;</span>,
    readCapacity: <span style="color:#fff;font-weight:bold">5</span>,
    writeCapacity: <span style="color:#fff;font-weight:bold">5</span>,
});

<span style="color:#007f7f">// let bmpiAllPageViewsRoute = &#34;bmpi-dev-all-page-views&#34;; // all page views key
</span><span style="color:#007f7f"></span>
<span style="color:#007f7f">// Create an views API endpoint
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">const</span> viewsEndpoint = <span style="color:#fff;font-weight:bold">new</span> awsx.apigateway.API(<span style="color:#0ff;font-weight:bold">&#34;bmpi-dev-post-views&#34;</span>, {
    routes: [{
        path: <span style="color:#0ff;font-weight:bold">&#34;/{route+}&#34;</span>,
        method: <span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>,
        eventHandler: <span style="color:#fff;font-weight:bold">async</span> (event) =&gt; {
            <span style="color:#fff;font-weight:bold">const</span> route = event.pathParameters![<span style="color:#0ff;font-weight:bold">&#34;route&#34;</span>];

            console.log(<span style="color:#0ff;font-weight:bold">`Getting count for &#39;</span><span style="color:#0ff;font-weight:bold">${</span>route<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">&#39;`</span>);

            <span style="color:#fff;font-weight:bold">const</span> client = <span style="color:#fff;font-weight:bold">new</span> aws.sdk.DynamoDB.DocumentClient();

            <span style="color:#fff;font-weight:bold">const</span> result = <span style="color:#fff;font-weight:bold">await</span> client.update({
                TableName: <span style="color:#fff;font-weight:bold">counterTable.name.get</span>(),
                Key: { id: <span style="color:#fff;font-weight:bold">route</span> },
                UpdateExpression: <span style="color:#0ff;font-weight:bold">&#34;SET hit = if_not_exists(hit, :zero) + :incr&#34;</span>,
                ExpressionAttributeValues: { <span style="color:#0ff;font-weight:bold">&#34;:zero&#34;</span>: <span style="color:#ff0;font-weight:bold">0</span>, <span style="color:#0ff;font-weight:bold">&#34;:incr&#34;</span>: <span style="color:#ff0;font-weight:bold">1</span> },
                ReturnValues:<span style="color:#0ff;font-weight:bold">&#34;UPDATED_NEW&#34;</span>,
            }).promise();

            <span style="color:#fff;font-weight:bold">let</span> count = result.Attributes!.hit;
            
            <span style="color:#fff;font-weight:bold">return</span> {
                statusCode: <span style="color:#fff;font-weight:bold">200</span>,
                headers: {
                    <span style="color:#0ff;font-weight:bold">&#34;Access-Control-Allow-Headers&#34;</span> : <span style="color:#0ff;font-weight:bold">&#34;Content-Type&#34;</span>,
                    <span style="color:#0ff;font-weight:bold">&#34;Access-Control-Allow-Origin&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;https://www.bmpi.dev&#34;</span>,
                    <span style="color:#0ff;font-weight:bold">&#34;Access-Control-Allow-Methods&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;OPTIONS,POST,GET&#34;</span>
                },
                body: <span style="color:#fff;font-weight:bold">JSON.stringify</span>({ route, count }),
            };
        },
    }],
});

<span style="color:#007f7f">// We have registered a domain, and a cert already (we could do most of this with Pulumi as well if we wanted!)
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">let</span> domainName = <span style="color:#0ff;font-weight:bold">&#34;api.bmpi.dev&#34;</span>; <span style="color:#007f7f">// `bmpi.dev` is regitered with Route53 
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">let</span> route53DomainZoneId = <span style="color:#0ff;font-weight:bold">&#34;Z3D746J1ZFXBYQ&#34;</span>; <span style="color:#007f7f">// The Hosted Zone I got when I registered `bmpi.dev`
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">let</span> certARN = <span style="color:#0ff;font-weight:bold">&#34;arn:aws:acm:us-east-1:745121664662:certificate/6e610430-46c8-4884-a1f7-471be45decf4&#34;</span>; <span style="color:#007f7f">// ACM cert for `*.bmpi.dev`
</span><span style="color:#007f7f"></span>
<span style="color:#007f7f">// API Gateway requires we register the Domain with it first
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">const</span> domain = <span style="color:#fff;font-weight:bold">new</span> aws.apigateway.DomainName(<span style="color:#0ff;font-weight:bold">&#34;domain&#34;</span>, {
    certificateArn: <span style="color:#fff;font-weight:bold">certARN</span>,
    domainName: <span style="color:#fff;font-weight:bold">domainName</span>,
});

<span style="color:#007f7f">// Then we can map a REST API to a domain with a BasePathMapping
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">const</span> mapping = <span style="color:#fff;font-weight:bold">new</span> aws.apigateway.BasePathMapping(<span style="color:#0ff;font-weight:bold">&#34;mapping&#34;</span>, {
    restApi: <span style="color:#fff;font-weight:bold">viewsEndpoint.restAPI</span>,
    basePath: <span style="color:#0ff;font-weight:bold">&#34;page-views&#34;</span>, <span style="color:#007f7f">// We map our API into the &#34;/page-views&#34; base path
</span><span style="color:#007f7f"></span>    stageName: <span style="color:#fff;font-weight:bold">viewsEndpoint.stage.stageName</span>, <span style="color:#007f7f">// We map the stage we got for free with `.x.API` above
</span><span style="color:#007f7f"></span>    domainName: <span style="color:#fff;font-weight:bold">domain.domainName</span>, <span style="color:#007f7f">// We map it into the domain we registered above
</span><span style="color:#007f7f"></span>});

<span style="color:#007f7f">// Finally, we need a DNS reocrd to point at our API Gateway
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">const</span> record = <span style="color:#fff;font-weight:bold">new</span> aws.route53.Record(<span style="color:#0ff;font-weight:bold">&#34;record&#34;</span>, {
    <span style="color:#fff;font-weight:bold">type</span>: <span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>,
    zoneId: <span style="color:#fff;font-weight:bold">route53DomainZoneId</span>,
    name: <span style="color:#fff;font-weight:bold">domainName</span>, <span style="color:#007f7f">// Write a record for `api.bmpi.dev` into the zone for `bmpi.dev`
</span><span style="color:#007f7f"></span>    aliases: [{
        name: <span style="color:#fff;font-weight:bold">domain.cloudfrontDomainName</span>, <span style="color:#007f7f">// APIGateway provides it&#39;s own CloudFront distribution we can point at...
</span><span style="color:#007f7f"></span>        zoneId: <span style="color:#fff;font-weight:bold">domain.cloudfrontZoneId</span>,
        evaluateTargetHealth: <span style="color:#fff;font-weight:bold">true</span>,
    }],
});

<span style="color:#007f7f">// It might take a while after we deploy the record above before the DNS propagates and allows us to resolve these URLs...
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">export</span> <span style="color:#fff;font-weight:bold">let</span> endpoint = pulumi.interpolate<span style="color:#0ff;font-weight:bold">`https://</span><span style="color:#0ff;font-weight:bold">${</span>record.name<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">/page-views`</span>;
</code></pre></div><p>æ‰€æœ‰çš„ä»£ç å°±è¿™äº›ï¼Œç„¶åä¸€é”®éƒ¨ç½²ä¸Šçº¿ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pulumi up
</code></pre></div><p>ä¸åˆ° 100 è¡Œçš„ä»£ç æˆ‘ä»¬å®Œæˆäº†ä»€ä¹ˆåŠŸèƒ½ï¼Ÿ</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª dynamodb è¡¨ï¼›</li>
<li>å®ç°äº†ä¸€ä¸ª Serverless APIï¼Œæ”¯æŒä»¥<strong>åŸå­æ€§</strong>æ›´æ–°ç‰¹å®š URL çš„è®¿é—®è®¡æ•°ï¼Œå¹¶ä¸”å¼€å¯äº† <code>CORS</code> æ”¯æŒï¼›</li>
<li>åˆ›å»ºäº†ä¸€ä¸ª API Gateway å¹¶ä¸”ç»‘å®šäº† <code>api.bmpi.dev</code> åŸŸåä¸”å¼€å¯äº† HTTPS æ”¯æŒï¼›</li>
<li>åˆ›å»ºäº† <code>api.bmpi.dev</code> åŸŸåçš„ DNS è®°å½•ï¼›</li>
<li>è¾“å‡ºäº†æ­¤æ¥å£çš„è¯·æ±‚åœ°å€ã€‚</li>
</ol>
<p>ä½“ä¼šåˆ° Pulumi çš„å¼ºå¤§äº†å—ï¼Ÿä¸€è¡Œä»£ç å®Œæˆäº†å¾ˆå¤šåŸºç¡€è®¾æ–½çš„é…ç½®ï¼Œè¿™å°±æ˜¯ IaC çš„å¼ºå¤§ï¼</p>
<p>ä¹‹åçš„å·¥ä½œå°±ç®€å•äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨é¡µé¢é€šè¿‡ JS è°ƒç”¨æ­¤æ¥å£å³å¯ï¼Œä»£ç è§è¿™ä¸ª commit: <a href="https://github.com/bmpi-dev/bmpi.dev/commit/a7cccfd7e9e25d7eed513b471a53d9327d738d0e">add post page hit count feature</a> ã€‚</p>
<p>æœ€ç»ˆæ•ˆæœè§ï¼š</p>
<p><img data-src="https://img.bmpi.dev/747c5497-bda7-fd39-2f2a-420ac7718c9e.png" alt="" class="lazyload" loading="lazy"/></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Jamstack + Serverless æ˜¯å®ç°ç°ä»£ Web å¼€å‘å¾ˆæµè¡Œçš„æ–¹å¼ï¼Œå°¤å…¶æ˜¯åœ¨åšä¸€äº›ä¸ªäººé¡¹ç›®çš„æ—¶å€™ï¼Œä¸€ä¸ªäººå°±æ˜¯ä¸€ä¸ªå›¢é˜Ÿã€‚</p>


        
        <div style="color: #5c7080;font-size: small;font-style: italic;">
          æ›´æ–°æ—¶é—´:
          
          
          
          
          
              4ä¸ªæœˆå‰
          
           ç‰ˆæœ¬: <a href="https://github.com/madawei2699/bmpi.dev/commit/e98fa49d877b6110e43ca9d38fa5cc40aaf68e2d">e98fa49</a>
        </div>
        

        <div style="text-align: center;color: darkgray;">
          
          <p>æœ¬ä½œå“é‡‡ç”¨<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" style="color: darkgray;">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯</p>
          
        </div>

        <div style="border-bottom-style: dashed;border-bottom-style: inset;border-bottom-width: 2px;width: 50%;margin: 0 auto;"></div>
      </div>

      <footer>
        <div>
  
  <h2 style="border-style: none;margin: 10px 0;">ç›¸å…³æ–‡ç« æ¨è</h2>
  
  <div style="padding-left: 10px;">
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li style="list-style: none;"><a href="https://www.bmpi.dev/dev/guide-to-setup-blog-site-with-zero-cost-5/">é›¶æˆæœ¬æ­å»ºç°ä»£åšå®¢ä¹‹ä¼˜åŒ–å›½å†…è®¿é—®é€Ÿåº¦</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li style="list-style: none;"><a href="https://www.bmpi.dev/dev/guide-to-serverless/">Serverlessåº”ç”¨å¼€å‘å°è®°</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li style="list-style: none;"><a href="https://www.bmpi.dev/dev/guide-to-setup-blog-site-with-zero-cost-4/">é›¶æˆæœ¬æ­å»ºç°ä»£åšå®¢ä¹‹åŠ è½½é€Ÿåº¦ä¼˜åŒ–ç¯‡</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li style="list-style: none;"><a href="https://www.bmpi.dev/dev/guide-to-setup-blog-site-with-zero-cost-3/">é›¶æˆæœ¬æ­å»ºç°ä»£åšå®¢ä¹‹è®¢é˜…æ¨é€ç¯‡</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li style="list-style: none;"><a href="https://www.bmpi.dev/dev/guide-to-setup-blog-site-with-zero-cost-2/">é›¶æˆæœ¬æ­å»ºç°ä»£åšå®¢ä¹‹SEOä¼˜åŒ–ç¯‡</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li style="list-style: none;"><a href="https://www.bmpi.dev/dev/guide-to-setup-blog-site-with-zero-cost-1/">é›¶æˆæœ¬æ­å»ºç°ä»£åšå®¢ä¹‹æ­å»ºç¯‡</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li style="list-style: none;"><a href="https://www.bmpi.dev/dev/aws-lambda-edge-img-to-webp/">ä½¿ç”¨AWS Lambdaæé«˜ç½‘ç«™å›¾ç‰‡åŠ è½½é€Ÿåº¦1Xå€</a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
  </div>
  <div style="border-bottom-style: dashed;border-bottom-style: inset;border-bottom-width: 2px;width: 50%;margin: 20px auto;"></div>
</div>

        <div class="sharethis-inline-reaction-buttons"></div>
<div class="sharethis-inline-share-buttons"></div>

        <div style="color: darkgreen;">
  <form style="border:1px dashed #ccc;padding:10px 10px;margin: 10px auto;text-align:center;width: 95%;" action="https://tinyletter.com/i365" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/i365', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    
    <span>æ¯æœˆä¸€ä»½é‚®ä»¶ï¼Œåˆ†äº«æˆ‘å¯¹å¦‚ä½•æ„å»ºè¢«åŠ¨æ”¶å…¥çš„æ€è€ƒã€æ¨èæ–‡ç« åŠèµ„æºï¼Œæ¬¢è¿è®¢é˜…</span>
    
    <p style="margin: 10px 0;"><input type="text" style="width:240px;text-align: center;" name="email" id="tlemail" placeholder="Email"/></p>
    <input type="hidden" value="1" name="embed"/>
    
    <input type="submit" value="è®¢é˜…" />
    
  </form>
</div>

        

<section class="see-also">
  
    
    
    
  
</section>


        
        
        <script src="https://utteranc.es/client.js"
  repo= "bmpi-dev/bmpi.dev"
  issue-term="title"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <div class="footer-taxonomy">
    <div style="margin-bottom: 10px;">
      <a href="https://wiki.bmpi.dev/">Wiki</a>
      âš”ï¸
      <a href="https://talk.bmpi.dev/">Talk</a>
      âš”ï¸
      <a href="https://www.bmpi.dev/invest/">Invest</a>
    </div>
    <div>
      <a href= /affiliate >Affiliate</a>
      âš¡ï¸
      <a href= /tool >Tool</a>
      âš¡ï¸
      <a href= /link >Link</a>
    </div>
  </div>
  <div class="footer-taxonomy">
    <a href= /tags style="color: #B36D61;">Tags</a>
    ğŸ‘ˆ
    <a href= /categories style="color: #FF8C31;">Categories</a>
    ğŸ‘‰
    <a href= /series style="color: #519A73;">Series</a>
  </div>
  <section class="container">
    
     Â© 2019 - 2021
    
    
  </section>
</footer>

  </main>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154678195-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-154678195-1');
  </script>
  

  
  <script>(function(w,d, s, id) {w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.src = "https://cdn.webpushr.com/app.min.js";fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));webpushr('init','BHuwaXciWicBjh6HQS2tfudv6IYQD11K9u1NUj7nuaEV9NoDT7ns9JjgqyYTflUv-m3TlD7ELY84AHMfgmPXNgU');</script>
  

</body>

</html>
